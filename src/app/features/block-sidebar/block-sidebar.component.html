<div class="bg-gray-800 border-r border-gray-700 flex flex-col h-full lg:h-[calc(100vh-20px)] overflow-y-auto">
  
  <!-- Mobile Close Button (visible on small screens) -->
  <div class="lg:hidden p-4 border-b border-gray-700 flex justify-between items-center">
    <div>
      <h1 class="text-lg font-bold text-white">Block Dashboard</h1>
      <p class="text-gray-400 text-xs">Manage your blocks</p>
    </div>
    <button 
      (click)="onCloseMobileSidebar()" 
      class="p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Desktop Header (visible on large screens) -->
  <div class="hidden lg:block p-4 border-b border-gray-700 sticky top-0 bg-gray-800 z-10">
    <h1 class="text-lg font-bold text-white">Block Dashboard</h1>
    <p class="text-gray-400 text-xs">Manage your blocks</p>
    
    <!-- Block Statistics -->
    <div class="mt-2 flex gap-4 text-xs">
      <span class="text-green-400">{{ visibleBlocksCount }} visible</span>
      <span class="text-red-400">{{ hiddenBlocksCount }} hidden</span>
      <span class="text-gray-400">{{ totalBlocksCount }} total</span>
    </div>
  </div>

  <!-- Messages -->
  @if (message) {
    <div class="mx-3 lg:mx-4 mt-3 p-2 rounded-md text-sm text-white"
         [class]="messageType === 'error' ? 'bg-red-600' : 'bg-green-600'">
      {{ message }}
    </div>
  }

  <!-- Loading -->
  @if (isLoading) {
    <div class="flex-1 flex items-center justify-center p-4">
      <div class="text-center">
        <div class="animate-spin h-6 w-6 border-b-2 border-white rounded-full inline-block"></div>
        <p class="text-gray-400 text-sm mt-2">Loading blocks...</p>
      </div>
    </div>
  }

  <!-- Blocks List -->
  @if (!isLoading) {
    <div class="flex-1 p-3 lg:p-4 pb-8 space-y-2">
      
      <!-- Controls Section -->
      <div class="mb-4 space-y-2">
        <div class="flex justify-between items-center">
          <h2 class="text-white text-sm font-semibold">All Blocks ({{ blocks.length }})</h2>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex gap-2">
          <button 
            (click)="clearSession()" 
            class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-md transition-colors">
            Clear Session
          </button>
        </div>
      </div>

      <!-- Empty State -->
      @if (blocks.length === 0) {
        <div class="text-center py-8 text-gray-400 text-sm">
          <svg class="w-10 h-10 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2" />
          </svg>
          <p>No blocks available</p>
          <p class="text-xs mt-1">Initialize session to load blocks</p>
        </div>
      }

      <!-- Simple Block Cards Container -->
      @if (blocks.length > 0) {
        <div class="space-y-2">
          
          <!-- Block Cards -->
          @for (block of blocks; track block.key) {
            <div
                 (click)="selectBlock(block)"
                 class="p-3 lg:p-4 rounded-lg border cursor-pointer group transition-all hover:shadow-md"
                 [class]="selectedBlockKey === block.key 
                            ? 'bg-blue-800 border-blue-600 shadow-md' 
                            : 'bg-gray-700 border-gray-600 hover:bg-gray-600 hover:border-gray-500'">

              <!-- Block Header -->
              <div class="flex items-center justify-between mb-2">
                <!-- Block Title -->
                <h3 class="text-white font-semibold text-sm flex-1 truncate pr-2">
                  {{ block.data?.title_en || getComponentDisplayName(block.key) }}
                </h3>

                <!-- Status Badge -->
                <span class="text-xs px-2 py-1 rounded-full flex-shrink-0"
                      [class]="block.show === 1 ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'">
                  {{ block.show === 1 ? 'Visible' : 'Hidden' }}
                </span>
              </div>

              <!-- Block Key (for reference) -->
              <div class="mb-2">
                <p class="text-gray-400 text-xs font-mono truncate">
                  {{ block.key }}
                </p>
              </div>

              <!-- Additional Info -->
              <div class="flex items-center gap-3 text-xs text-gray-400">
                @if (block.data?.items?.length) {
                  <span class="flex items-center gap-1">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                    {{ block.data.items?.length }} items
                  </span>
                }
                
                <span class="flex items-center gap-1">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                  </svg>
                  Store: {{ block.store_id }}
                </span>
                
                <span class="flex items-center gap-1">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  </svg>
                  Funnel: {{ block.funnel_id }}
                </span>
              </div>

              <!-- Selection Indicator -->
              @if (selectedBlockKey === block.key) {
                <div class="mt-2 pt-2 border-t border-blue-500">
                  <div class="flex items-center gap-2 text-blue-300 text-xs">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span>Currently Selected</span>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>